#!/usr/bin/env ruby

require "logger"

module BoshWorkstationCpiSetup
  class Setup
    MICRO_GEM_NAME = "bosh_cli_plugin_micro"

    def initialize(logger=Logger.new(STDERR))
      @logger = logger
    end

    def set_up
      config_path = find_config_path
      write_config_file(config_path)
    end

    private

    def find_config_path
      @logger.info("Finding '#{MICRO_GEM_NAME}'")
      spec = ::Gem::Specification.find_by_name(MICRO_GEM_NAME)
      "#{spec.gem_dir}/config/workstation_defaults.yml"
    end

    def write_config_file(config_path)
      @logger.info("Creating default config in '#{config_path}'")
      File.write(config_path, "# Generated by '#{__FILE__}'\n---\n{}\n")
    end
  end
end

BoshWorkstationCpiSetup::Setup.new.set_up
